!function(factory,window){"function"==typeof define&&define.amd?define(["leaflet"],factory):"object"==typeof exports&&(module.exports=factory(require("leaflet"))),"undefined"!=typeof window&&window.L&&(window.L.MapCommentTool=factory(L))}(function(L){var MapCommentTool={};return MapCommentTool.options={},MapCommentTool.getMessage=function(){return"Map Comment Tool"},MapCommentTool.addTo=function(map){var self=this,customControl=L.Control.extend({options:{position:"topleft"},onAdd:function(map){var container=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-custom");return container.style.backgroundColor="white",container.style.width="40px",container.style.height="40px",container.style.cursor="pointer",container.innerHTML='<img src=pencil.png class="panel-control-icon">',container.onclick=function(){self.ControlBar.toggle()},container}});map.addControl(new customControl);var visibileClass=self.ControlBar.isVisible()?"visible":"";self.ControlBar.options.position=window.innerHeight<window.innerWidth?"right":"bottom";var container=self.ControlBar._container=L.DomUtil.create("div","leaflet-control-bar-"+self.ControlBar.options.position+" leaflet-control-bar "+visibileClass);self.ControlBar._contentContainer;L.DomEvent.on(container,"transitionend",self.ControlBar._handleTransitionEvent,self).on(container,"webkitTransitionEnd",self.ControlBar._handleTransitionEvent,self);var controlContainer=map._controlContainer;controlContainer.insertBefore(container,controlContainer.firstChild),self._map=map,map.MapCommentTool=MapCommentTool},MapCommentTool.ControlBar={options:{position:"right"},visible:!1,currentView:"",isVisible:function(){var self=this;return self.visible},show:function(){var self=this;self.visible=!0,L.DomUtil.addClass(self._container,"visible");for(var controls=document.getElementsByClassName("leaflet-control leaflet-bar"),i=0;i<controls.length;i++)controls[i].style.visibility="hidden";return map.dragging.disable(),map.touchZoom.disable(),map.doubleClickZoom.disable(),map.scrollWheelZoom.disable(),map.boxZoom.disable(),map.keyboard.disable(),map.tap&&map.tap.disable(),document.getElementById("map").style.cursor="default",self.currentView=self.displayControl("home"),!0},hide:function(e){var self=this;self.visible=!1,L.DomUtil.removeClass(self._container,"visible");for(var controls=document.getElementsByClassName("leaflet-control leaflet-bar"),i=0;i<controls.length;i++)controls[i].style.visibility="visible";return e&&L.DomEvent.stopPropagation(e),map.dragging.enable(),map.touchZoom.enable(),map.doubleClickZoom.enable(),map.scrollWheelZoom.enable(),map.boxZoom.enable(),map.keyboard.enable(),map.tap&&map.tap.enable(),document.getElementById("map").style.cursor="grab",!0},toggle:function(){var self=this,toggleSuccess=self.isVisible()?self.hide():self.show();return toggleSuccess},_handleTransitionEvent:function(e){},displayControl:function(mode){var self=this;switch(L.DomUtil.empty(self._container),mode){case"home":self.homeView()}return mode},homeView:function(){var self=this,homeView=L.DomUtil.create("div","controlbar-view controlbar-home",self._container),closeButton=L.DomUtil.create("button","controlbar-button controlbar-close",homeView);closeButton.onclick=function(){self.hide()};var newCommentButton=(L.DomUtil.create("br","",homeView),L.DomUtil.create("button","controlbar-button controlbar-new",homeView));newCommentButton.innerHTML="New Comment",newCommentButton.onclick=function(){return self.startNewComment()}},startNewComment:function(){return window.map.MapCommentTool.Comments.newComment()}},MapCommentTool.Comments={list:[],saved:function(comment){return comment.saveState},newComment:function(){var self=this,comment={};return comment.saveState=!1,comment.id=window.map.MapCommentTool.Util.generateGUID(),self.list.push(comment),comment}},MapCommentTool.Util={generateGUID:function(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}},MapCommentTool},window);
!function(factory,window){"function"==typeof define&&define.amd?define(["leaflet"],factory):"object"==typeof exports&&(module.exports=factory(require("leaflet"))),"undefined"!=typeof window&&window.L&&(window.L.MapCommentTool=factory(L))}(function(L){var MapCommentTool={options:{},getMessage:function(){return"Map Comment Tool"},addTo:function(map){var self=this;self.currentMode="map";var customControl=L.Control.extend({options:{position:"topleft"},onAdd:function(){var container=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-custom");return container.style.backgroundColor="white",container.style.width="40px",container.style.height="40px",container.style.cursor="pointer",container.innerHTML='<img src=pencil.png class="panel-control-icon">',container.onclick=function(){self.ControlBar.toggle()},container}});map.addControl(new customControl);var visibileClass=self.ControlBar.isVisible()?"visible":"";self.ControlBar.options.position=window.innerHeight<window.innerWidth?"right":"bottom";{var container=self.ControlBar._container=L.DomUtil.create("div","leaflet-control-bar-"+self.ControlBar.options.position+" leaflet-control-bar "+visibileClass);self.ControlBar._contentContainer}L.DomEvent.on(container,"transitionend",self.ControlBar._handleTransitionEvent,self).on(container,"webkitTransitionEnd",self.ControlBar._handleTransitionEvent,self);var controlContainer=map._controlContainer;controlContainer.insertBefore(container,controlContainer.firstChild),self._map=map,map.MapCommentTool=MapCommentTool},startDrawingMode:function(comment){var self=this;self.drawingCanvas=L.canvas({padding:0}),self.drawingCanvas.addTo(map),self.currentMode="drawing",self.ControlBar.currentView=self.ControlBar.displayControl("drawing",comment.id)},stopDrawingMode:function(){var self=this;self.drawingCanvas.removeFrom(map),delete self.drawingCanvas,self.currentMode="controlBarHome",self.ControlBar.currentView=self.ControlBar.displayControl("home")}};return MapCommentTool.ControlBar={options:{position:"right"},visible:!1,currentView:"",isVisible:function(){var self=this;return self.visible},show:function(){var self=this;window.map.MapCommentTool.currentMode="controlBarHome",self.visible=!0,L.DomUtil.addClass(self._container,"visible");for(var controls=document.getElementsByClassName("leaflet-control leaflet-bar"),i=0;i<controls.length;i++)controls[i].style.visibility="hidden";return map.dragging.disable(),map.touchZoom.disable(),map.doubleClickZoom.disable(),map.scrollWheelZoom.disable(),map.boxZoom.disable(),map.keyboard.disable(),map.tap&&map.tap.disable(),document.getElementById("map").style.cursor="default",self.currentView=self.displayControl("home"),!0},hide:function(e){var self=this;window.map.MapCommentTool.currentMode="map",self.visible=!1,L.DomUtil.removeClass(self._container,"visible");for(var controls=document.getElementsByClassName("leaflet-control leaflet-bar"),i=0;i<controls.length;i++)controls[i].style.visibility="visible";return e&&L.DomEvent.stopPropagation(e),map.dragging.enable(),map.touchZoom.enable(),map.doubleClickZoom.enable(),map.scrollWheelZoom.enable(),map.boxZoom.enable(),map.keyboard.enable(),map.tap&&map.tap.enable(),document.getElementById("map").style.cursor="grab",!0},toggle:function(){var self=this,toggleSuccess=self.isVisible()?self.hide():self.show();return toggleSuccess},_handleTransitionEvent:function(){},displayControl:function(mode,commentId){var self=this;switch(L.DomUtil.empty(self._container),mode){case"home":self.homeView();break;case"drawing":self.drawingView(commentId)}return mode},homeView:function(){var self=this,homeView=L.DomUtil.create("div","controlbar-view controlbar-home",self._container),closeButton=L.DomUtil.create("button","controlbar-button controlbar-close",homeView);closeButton.onclick=function(){self.hide()};var newCommentButton=(L.DomUtil.create("br","",homeView),L.DomUtil.create("button","controlbar-button controlbar-new",homeView));newCommentButton.innerHTML="New Comment",newCommentButton.onclick=function(){return self.startNewComment()}},drawingView:function(commentId){var self=this,drawingView=L.DomUtil.create("div","controlbar-view controlbar-home",self._container),saveDrawingButton=(L.DomUtil.create("br","",drawingView),L.DomUtil.create("button","controlbar-button controlbar-save",drawingView));saveDrawingButton.innerHTML="Save",saveDrawingButton.onclick=function(){self.saveDrawing(commentId)};var cancelDrawingButton=L.DomUtil.create("button","controlbar-button controlbar-cancel",drawingView);cancelDrawingButton.innerHTML="Cancel",cancelDrawingButton.onclick=function(){self.cancelDrawing(commentId)}},startNewComment:function(){var newComment=window.map.MapCommentTool.Comments.newComment();return window.map.MapCommentTool.startDrawingMode(newComment),newComment},saveDrawing:function(commentId){var commentIndex=window.map.MapCommentTool.Comments.list.findIndex(function(comment){return comment.id===commentId});return window.map.MapCommentTool.Comments.list[commentIndex].saveState=!0,window.map.MapCommentTool.stopDrawingMode(),!0},cancelDrawing:function(commentId){var commentIndex=window.map.MapCommentTool.Comments.list.findIndex(function(comment){return comment.id===commentId}),comment=window.map.MapCommentTool.Comments.list[commentIndex];return comment.saveState||window.map.MapCommentTool.Comments.list.pop(),window.map.MapCommentTool.stopDrawingMode(),!0}},MapCommentTool.Comments={list:[],saved:function(comment){return comment.saveState},newComment:function(){var self=this,comment={};return comment.saveState=!1,comment.id=window.map.MapCommentTool.Util.generateGUID(),self.list.push(comment),comment}},MapCommentTool.Util={generateGUID:function(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}},MapCommentTool},window);